<!DOCTYPE html>
<html lang="gu">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ркмрк╛рк│ рк╡рк┐ркХрк╛рк╕ ркЪрлЗркХрк░</title>
  <style>
    :root {
      --primary: #e65100;
      --success: #2e7d32;
      --warning: #f57c00;
      --danger: #d32f2f;
      --bg: #fdf6f0;
      --card: #ffffff;
      --text: #333333;
    }
    body {
      font-family: 'Segoe UI', Tahoma, sans-serif;
      background: var(--bg);
      color: var(--text);
      margin: 0;
      padding: 12px;
    }
    .container {
      max-width: 600px;
      margin: auto;
      background: var(--card);
      padding: 18px;
      border-radius: 16px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    }
    .current-month {
      text-align: center;
      background: #fff8e1;
      padding: 10px;
      border-radius: 10px;
      font-weight: bold;
      color: #e65100;
      margin-bottom: 12px;
      border: 1px solid #ffcc80;
    }
    h1 {
      text-align: center;
      color: var(--primary);
      font-size: 22px;
      margin-bottom: 18px;
    }
    label {
      display: block;
      margin: 14px 0 6px;
      font-weight: bold;
    }
    input, select {
      width: 100%;
      padding: 13px;
      border: 1px solid #ccc;
      border-radius: 10px;
      font-size: 16px;
      box-sizing: border-box;
    }
    .btn {
      background: var(--primary);
      color: white;
      border: none;
      padding: 14px;
      width: 100%;
      font-size: 17px;
      border-radius: 10px;
      margin-top: 12px;
      cursor: pointer;
      font-weight: bold;
    }
    .btn:hover { opacity: 0.9; }
    .btn-group {
      display: flex;
      gap: 10px;
      margin-top: 12px;
    }
    .btn-group button {
      flex: 1;
    }
    .result-box {
      margin-top: 20px;
      padding: 15px;
      border-radius: 10px;
      font-weight: bold;
      display: none;
    }
    .normal { background: #e8f5e9; color: var(--success); }
    .risk { background: #fff3e0; color: var(--warning); }
    .severe { background: #ffebee; color: var(--danger); }
    footer {
      text-align: center;
      margin-top: 20px;
      font-size: 14px;
      color: #666;
    }

    /* Preview Modal */
    #previewModal {
      display: none;
      position: fixed;
      z-index: 100;
      left: 0; top: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.6);
    }
    .modal-content {
      background: white;
      margin: 40px auto;
      padding: 20px;
      width: 90%;
      max-width: 600px;
      border-radius: 16px;
      max-height: 80vh;
      overflow-y: auto;
    }
    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
      padding-bottom: 10px;
      border-bottom: 2px solid #eee;
    }
    .close-btn {
      background: #f44336;
      color: white;
      border: none;
      width: 30px;
      height: 30px;
      border-radius: 50%;
      cursor: pointer;
      font-weight: bold;
    }
    .record-item {
      padding: 12px;
      margin: 10px 0;
      background: #f9f9f9;
      border-left: 4px solid var(--primary);
      border-radius: 8px;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="current-month">
      ркЪрк╛рк▓рлБ ркорк╣рк┐ркирлЛ: ркирк╡рлЗркорлНркмрк░ 2025
    </div>

    <h1>ркмрк╛рк│ рк╡рк┐ркХрк╛рк╕ ркЪрлЗркХрк░ (0тАУ5 рк╡рк░рлНрк╖)</h1>

    <label for="name">ркмрк╛рк│ркХркирлБркВ ркирк╛рко:</label>
    <input type="text" id="name" placeholder="ркЙркжрк╛. ркХрлГрк╖рлНркг" value="рк░рк╛ркЬ" />

    <label for="gender">рк▓рк┐ркВркЧ:</label>
    <select id="gender">
      <option value="male">ркХрлБркорк╛рк░ (ркЫрлЛркХрк░рлЛ)</option>
      <option value="female" selected>ркХркирлНркпрк╛ (ркЫрлЛркХрк░рлА)</option>
    </select>

    <label for="age">ркЙркВркорк░ (ркорк╣рк┐ркирк╛ркорк╛ркВ, 0тАУ60):</label>
    <input type="number" id="age" min="0" max="60" placeholder="ркЙркжрк╛. 24" value="24" />

    <label for="weight">рк╡ркЬрки (kg):</label>
    <input type="number" id="weight" step="0.1" placeholder="ркЙркжрк╛. 10.5" value="10.5" />

    <label for="height">ркКркВркЪрк╛ркИ (cm):</label>
    <input type="number" id="height" step="0.1" placeholder="ркЙркжрк╛. 85" value="85" />

    <button class="btn" onclick="analyzeGrowth()">рк╡рк┐ркХрк╛рк╕ ркЪрлЗркХ ркХрк░рлЛ</button>

    <div id="weightResult" class="result-box"></div>
    <div id="heightResult" class="result-box"></div>

    <div class="btn-group">
      <button class="btn" style="background:#4caf50;" onclick="saveRecord()">Save</button>
      <button class="btn" style="background:#2196f3;" onclick="showPreview()">Report Preview</button>
    </div>

    <button class="btn" style="background:#9c27b0;margin-top:10px;" onclick="copyReport()">Copy Report</button>
  </div>

  <div id="previewModal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>рк░рк┐рккрлЛрк░рлНркЯ рккрлНрк░рк┐рк╡рлНркпрлБ тАУ ркирк╡рлЗркорлНркмрк░ 2025</h2>
        <button class="close-btn" onclick="closePreview()">├Ч</button>
      </div>
      <div id="previewContent"></div>
    </div>
  </div>

  <footer>
    Copyright ┬й Devendra Ramanuj, Mo. 9276505035
  </footer>

  <script>
    function getThresholds(gender, age) {
      if (gender === "male") {
        if (age <= 12) return 2.5 + (age * 0.15);
        if (age <= 24) return 6.7 + ((age - 12) * 0.25);
        return 9.7 + ((age - 24) * 0.15);
      } else {
        if (age <= 12) return 2.4 + (age * 0.14);
        if (age <= 24) return 5.9 + ((age - 12) * 0.22);
        return 8.3 + ((age - 24) * 0.13);
      }
    }

    function getHeightThreshold(gender, age) {
      if (gender === "male") {
        if (age <= 24) return 46 + (age * 1.3);
        return 75.8 + ((age - 24) * 0.5);
      } else {
        if (age <= 24) return 45 + (age * 1.2);
        return 73 + ((age - 24) * 0.48);
      }
    }

    let currentRecord = null;

    function analyzeGrowth() {
      const name = document.getElementById("name").value.trim() || "ркмрк╛рк│ркХ";
      const gender = document.getElementById("gender").value;
      const age = parseFloat(document.getElementById("age").value);
      const weight = parseFloat(document.getElementById("weight").value);
      const height = parseFloat(document.getElementById("height").value);

      document.getElementById("weightResult").style.display = "none";
      document.getElementById("heightResult").style.display = "none";

      if (isNaN(age) || isNaN(weight) || isNaN(height) || age < 0 || age > 60 || weight <= 0 || height <= 0) {
        currentRecord = null;
        alert("ркХрлГрккрк╛ ркХрк░рлАркирлЗ ркпрлЛркЧрлНркп ркорлВрк▓рлНркпрлЛ (0-60 ркорк╣рк┐ркирк╛, рк╡ркЬрки>0, ркКркВркЪрк╛ркИ>0) ркжрк╛ркЦрк▓ ркХрк░рлЛ.");
        return false;
      }

      const wTh = getThresholds(gender, age);
      const hTh = getHeightThreshold(gender, age);
      const uw = weight < wTh;
      const st = height < hTh;

      currentRecord = { name, gender, age, weight, height, underweight: uw, stunted: st };

      const wr = document.getElementById("weightResult");
      const hr = document.getElementById("heightResult");

      wr.textContent = uw ? `ЁЯФ┤ ${name} ркУркЫрк╛ рк╡ркЬркирк╡рк╛рк│рк╛ ркЫрлЗ (Underweight).` : `ЁЯЯв ${name} ркирлБркВ рк╡ркЬрки ркпрлЛркЧрлНркп ркЫрлЗ.`;
      wr.className = "result-box " + (uw ? "severe" : "normal");
      wr.style.display = "block";

      hr.textContent = st ? `ЁЯЯа ${name} ркУркЫрлА ркКркВркЪрк╛ркИрк╡рк╛рк│рк╛ ркЫрлЗ (Stunting).` : `ЁЯЯв ${name} ркирлА ркКркВркЪрк╛ркИ ркпрлЛркЧрлНркп ркЫрлЗ.`;
      hr.className = "result-box " + (st ? "risk" : "normal");
      hr.style.display = "block";

      return true;
    }

    function saveRecord() {
      const success = analyzeGrowth();
      if (!success || !currentRecord) {
        alert("ркбрлЗркЯрк╛ рк╕рлЗрк╡ ркХрк░ркдрк╛ рккрк╣рлЗрк▓рк╛ркВ ркпрлЛркЧрлНркп ркорлВрк▓рлНркпрлЛ ркжрк╛ркЦрк▓ ркХрк░рлЛ.");
        return;
      }

      const recs = JSON.parse(localStorage.getItem("childGrowthRecords") || "[]");
      recs.push({ ...currentRecord, date: "ркирк╡рлЗркорлНркмрк░ 2025" });
      localStorage.setItem("childGrowthRecords", JSON.stringify(recs));
      alert("тЬЕ рк░рлЗркХрлЛрк░рлНркб рк╕рк╛ркЪрк╡рк╛ркпрлЛ!");
    }

    function showPreview() {
      const savedRecords = JSON.parse(localStorage.getItem("childGrowthRecords") || "[]");
      const allRecords = [];

      if (currentRecord && 
          typeof currentRecord.name === 'string' && 
          typeof currentRecord.age === 'number' &&
          typeof currentRecord.weight === 'number' &&
          typeof currentRecord.height === 'number') {
        allRecords.push(currentRecord);
      }
      
      allRecords.push(...savedRecords);

      const previewContent = document.getElementById("previewContent");
      if (allRecords.length === 0) {
        previewContent.innerHTML = 
          `<div style="padding:20px;text-align:center;color:#666;font-size:16px;">
            ркХрлЛркИ рк░рлЗркХрлЛрк░рлНркб ркиркерлА.<br>
            рккрк╣рлЗрк▓рк╛ркВ "рк╡рк┐ркХрк╛рк╕ ркЪрлЗркХ ркХрк░рлЛ" ркХрлНрк▓рк┐ркХ ркХрк░рлЛ ркЕркирлЗ "Save" ркХрк░рлЛ.
           </div>`;
      } else {
        let html = `<div style="font-family:Arial,sans-serif;font-size:16px;line-height:1.5;">`;
        allRecords.forEach((r, i) => {
          const name = r.name || "ркмрк╛рк│ркХ";
          const gender = r.gender || "female";
          const genderText = gender === 'male' ? 'ркХрлБркорк╛рк░' : 'ркХркирлНркпрк╛';
          const age = typeof r.age === 'number' ? r.age : 0;
          const weight = typeof r.weight === 'number' ? r.weight.toFixed(1) : '0';
          const height = typeof r.height === 'number' ? r.height.toFixed(1) : '0';
          const underweight = r.underweight === true;
          const stunted = r.stunted === true;
          
          const weightStatus = underweight ? 'ркУркЫрлБркВ' : 'рк╕рк╛ркорк╛ркирлНркп';
          const heightStatus = stunted ? 'ркУркЫрлА' : 'рк╕рк╛ркорк╛ркирлНркп';

          html += `
            <div class="record-item">
              <b>рк░рлЗркХрлЛрк░рлНркб ${i+1}: ${name} (${genderText})</b><br>
              ркЙркВркорк░: ${age} ркорк╣рк┐ркирк╛<br>
              рк╡ркЬрки: ${weight} kg (${weightStatus})<br>
              ркКркВркЪрк╛ркИ: ${height} cm (${heightStatus})
            </div>
          `;
        });
        html += `</div>`;
        previewContent.innerHTML = html;
      }

      document.getElementById("previewModal").style.display = "block";
    }

    function closePreview() {
      document.getElementById("previewModal").style.display = "none";
    }

    // тЬЕ SAFE FOR ANDROID: Copy report as text
    function copyReport() {
      const savedRecords = JSON.parse(localStorage.getItem("childGrowthRecords") || "[]");
      const allRecords = [];

      if (currentRecord && 
          typeof currentRecord.name === 'string' && 
          typeof currentRecord.age === 'number' &&
          typeof currentRecord.weight === 'number' &&
          typeof currentRecord.height === 'number') {
        allRecords.push(currentRecord);
      }
      allRecords.push(...savedRecords);

      if (allRecords.length === 0) {
        alert("ркХрлЛркИ ркбрлЗркЯрк╛ ркиркерлА.");
        return;
      }

      let text = "ркмрк╛рк│ рк╡рк┐ркХрк╛рк╕ рк░рк┐рккрлЛрк░рлНркЯ тАУ ркирк╡рлЗркорлНркмрк░ 2025\n\n";
      allRecords.forEach((r, i) => {
        const name = r.name || "ркмрк╛рк│ркХ";
        const genderText = r.gender === 'male' ? 'ркХрлБркорк╛рк░' : 'ркХркирлНркпрк╛';
        const weightStatus = r.underweight ? 'ркУркЫрлБркВ' : 'рк╕рк╛ркорк╛ркирлНркп';
        const heightStatus = r.stunted ? 'ркУркЫрлА' : 'рк╕рк╛ркорк╛ркирлНркп';
        text += `рк░рлЗркХрлЛрк░рлНркб ${i+1}: ${name} (${genderText})\n`;
        text += `ркЙркВркорк░: ${r.age} ркорк╣рк┐ркирк╛\n`;
        text += `рк╡ркЬрки: ${r.weight} kg (${weightStatus})\n`;
        text += `ркКркВркЪрк╛ркИ: ${r.height} cm (${heightStatus})\n\n`;
      });

      if (navigator.clipboard) {
        navigator.clipboard.writeText(text).then(() => {
          alert("рк░рк┐рккрлЛрк░рлНркЯ ркХрлЙрккрлА ркеркИ ркЧркИ! рк╣рк╡рлЗ WhatsApp, Notes, ркЕркерк╡рк╛ Excel ркорк╛ркВ рккрлЗрк╕рлНркЯ ркХрк░рлЛ.");
        }).catch(() => {
          fallbackCopyText(text);
        });
      } else {
        fallbackCopyText(text);
      }
    }

    function fallbackCopyText(text) {
      const textarea = document.createElement('textarea');
      textarea.value = text;
      textarea.style.position = 'fixed';
      textarea.style.opacity = '0';
      document.body.appendChild(textarea);
      textarea.select();
      try {
        document.execCommand('copy');
        alert("рк░рк┐рккрлЛрк░рлНркЯ ркХрлЙрккрлА ркеркИ ркЧркИ! рк╣рк╡рлЗ ркХрлНркпрк╛ркВркХ рккрлЗрк╕рлНркЯ ркХрк░рлЛ.");
      } catch (e) {
        alert("ркХрлЙрккрлА ркХрк░рк╡рк╛ркорк╛ркВ ркирк┐рк╖рлНрклрк│. ркирлАркЪрлЗркирлБркВ ркЯрлЗркХрлНрк╕рлНркЯ ркорлЗркирлНркпрлБркЕрк▓рлА ркХрлЙрккрлА ркХрк░рлЛ:\n\n" + text);
      }
      document.body.removeChild(textarea);
    }

    window.onclick = function(event) {
      const modal = document.getElementById("previewModal");
      if (event.target === modal) {
        modal.style.display = "none";
      }
    }
  </script>
</body>
</html>
